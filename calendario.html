<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Calendario</title>
    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" href="http://eternicode.github.io/bootstrap-datepicker/bootstrap-datepicker/css/datepicker3.css">
    <!--<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css">
	--><style>	
		body{
			padding: 10px;
		}	
		.navbar-nav {
			margin-top: 12px;
		}
		.navbar {
			margin-bottom: 0px;
		}
		.year {
			font-size: 15px;
		}
		.month{
			font-size: 20px;
		}
		.datepicker table tr td, .datepicker table tr th {
			padding: 20px 20px;
			font-size: 25px;
		}
		label {
			-webkit-border-radius: 5px;
			-moz-border-radius: 5px;
			border-radius: 5px; 
		}
		.Perforacion {
			color: #ffffff !important;
			background-color: #7932B1;
			border-color: #7932B1;
		}
		.Perforacion:hover{
			background-color: #9F4BE0 !important;
		}
		.Yacimiento {
			color: #ffffff !important;
			background-color: #31A88C;
			border-color: #31A88C;
		}
		.Yacimiento:hover{
			background-color: #38BD9E !important;
		}
		.Administracion {
			color: #ffffff !important;
			background-color: #BDAD38;
			border-color: #BDAD38;
		}
		.Administracion:hover{
			background-color: #CAB937 !important;
		}
		.Finanzas {
			color: #ffffff !important;
			background-color: #B93895;
			border-color: #B93895;
		}
		.Finanzas:hover{
			background-color: #D658B3 !important;
		}		
		.multiple {
			color: #ffffff !important;
			background-color: #D5A9A9;
			border-color: #D5A9A9;
		}
		.multiple:hover{
			background-color: #E0BEBE !important;
		}
		.otros {
			color: #ffffff !important;
			background-color: #165C5F;
			border-color: #165C5F;
		}
		.otros:hover{
			background-color: #1D777A !important;
		}


	</style>
</head>
<body>
	<nav class="navbar navbar-default" role="navigation">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#">Mostrar: </a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li>
        	<label class="checkbox-inline"><input type="checkbox" id="checkboxEnLinea1" checked="true" > Todos</label>
			<label class="checkbox-inline Perforacion"><input type="checkbox" id="checkboxEnLinea2">Perforación</label>
			<label class="checkbox-inline Yacimiento"><input type="checkbox" id="checkboxEnLinea3" onClick="updateCalendario();"> Yacimiento</label>
			<label class="checkbox-inline Administracion"><input type="checkbox" id="checkboxEnLinea4" onClick="updateCalendario();"> Administración</label>
			<label class="checkbox-inline Finanzas"><input type="checkbox" id="checkboxEnLinea5" onClick="updateCalendario();"> Finanzas</label>
			<label class="checkbox-inline otros"><input type="checkbox" id="checkboxEnLinea6" onClick="updateCalendario();"> Otras áreas</label>
			<label class="checkbox-inline multiple">Múltiples Cursos</label>
		</li>
      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>


	<div class="container">
	  <div class="row" >
	    <div class="span8 offset2" id="calendario"></div>
	  </div>
	</div>



	<div class="panel panel-info">
		<!-- Default panel contents -->
		<div class="panel-heading">Cursos próximos a dictar</div>

		<!-- Table -->
		<div id="cursosproximos">
		</div>

	</div>
      <!-- Modal Ver Evento ARCHIVO -->
    <div class="modal fade" id="ModalVerEvento" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				<h4 class="modal-title" id="myModalLabel">Información</h4>
			</div>
			<!-- Table -->
			<div id="TablaVerCurso">
				</div>
			<div class="modal-footer">
				
			</div>
        </div>
      </div>
    </div>
    <!-- Fin Modal Descargar archivo -->
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
	<script src="js/bootstrap-datepicker.js"></script>	
	<script src="js/bootstrap-datepicker.es.js"></script>
    <script type="text/javascript">     
        $(document).ready(function () {

            var eventos;
            var contador = 0;
            var globaldesde = 0;

			MostrarCursosProximos();
			calendario();
			AbrirModal();

			function AbrirModal(){
				$('td.day').on('click',  function(){
					var datosCurso=$(this).attr('name');
					if(typeof datosCurso != "undefined"){
						$('td.day').attr('data-toggle',"modal");
						$('td.day').attr('data-target',"#ModalVerEvento");
						
						datosCurso = datosCurso.split("&&&");
						for(var i = 0; i < datosCurso.length; i++)
							datosCurso[i] = datosCurso[i].split("|||");
						LlenarModal(datosCurso);
					}
				});
		    }

			
		    function LlenarModal(datosCurso){
		    	$('#TablaVerCurso').html("");	

				var table = $('<table></table>').addClass('table table-hover');							
				var row= $('<tr></tr>');
				row.append($('<td></td>').html("<b>Curso</b>"));
				row.append($('<td></td>').html("<b>Area</b>"));							
				row.append($('<td></td>').html("<b>Desde</b>"));
				row.append($('<td></td>').html("<b>Hasta</b>"));
				row.append($('<td></td>').html("<b>Duracion</b>"));
				table.append(row);
				
				for(i=0; i<datosCurso.length; i++){
					var row2 = $('<tr></tr>');
					var fila1 = $('<td></td>').text(datosCurso[i][0]);
					var fila2 = $('<td></td>').text(datosCurso[i][1]);
					var fila3 = $('<td></td>').text(datosCurso[i][4]);
					var fila4 = $('<td></td>').text(datosCurso[i][5]);
					var fila5 = $('<td></td>').text(datosCurso[i][2]);
					row2.append(fila1);
					row2.append(fila2);
					row2.append(fila3);
					row2.append(fila4);
					row2.append(fila5);									
				    table.append(row2);
				}
				$('#TablaVerCurso').append(table);

		    }
		    function updateCalendario(){
		    	$('#calendario').datepicker('update');
			}
		    checkboxEnLinea1.onclick=function(){
		    	checkboxEnLinea2.checked = false;
		    	checkboxEnLinea3.checked = false;
		    	checkboxEnLinea4.checked = false;
		    	checkboxEnLinea5.checked = false;
		    	checkboxEnLinea6.checked = false;
				updateCalendario();
			}
			checkboxEnLinea2.onclick=function(){
				checkboxEnLinea1.checked = false;
				updateCalendario();
			}
			checkboxEnLinea3.onclick=function(){
				checkboxEnLinea1.checked = false;
				updateCalendario();
			}
			checkboxEnLinea4.onclick=function(){
				checkboxEnLinea1.checked = false;
				updateCalendario();
			}
			checkboxEnLinea5.onclick=function(){
				checkboxEnLinea1.checked = false;
				updateCalendario();
			}
			checkboxEnLinea6.onclick=function(){
				checkboxEnLinea1.checked = false;
				updateCalendario();
			}
            function buscarCursos(desde,hasta){
                $.ajax
				({
					type: "POST",
					url: "Modelo/consultasPortafolio.php",
					data: {id:12, desde:desde, hasta:hasta},
					async: false,	
					dataType: "json",		
					success:
					function (msg) 
					{	
						eventos = msg;
					},
					error:
					function (msg) {
						console.log("No se pudo realizar la conexion");}
				});		
        	}
        	function buscarProximosCursos(desde){
        		var result;
                $.ajax
				({
					type: "POST",
					url: "Modelo/consultasPortafolio.php",
					data: {id:13, desde:desde},
					async: false,	
					dataType: "json",		
					success:
					function (msg) 
					{	
						result = msg;
					},
					error:
					function (msg) {
						console.log("No se pudo realizar la conexion");}
				});	
				return result;	
        	}

        	
			function MostrarCursosProximos(){
				var desde = new Date();
	    		var resultCursos = buscarProximosCursos(desde/1000);
				$('#cursosproximos').html("");	

				var table = $('<table></table>').addClass('table table-hover');							
				var row= $('<tr></tr>');
				row.append($('<td></td>').html("<b>Curso</b>"));
				row.append($('<td></td>').html("<b>Area</b>"));							
				row.append($('<td></td>').html("<b>Desde</b>"));
				row.append($('<td></td>').html("<b>Hasta</b>"));
				row.append($('<td></td>').html("<b>Duracion</b>"));
				table.append(row);	
				
				for(i=0; i<resultCursos.length; i++){
					var row2 = $('<tr></tr>');
					var fila1 = $('<td></td>').text(resultCursos[i].Curso);
					var fila2 = $('<td></td>').text(resultCursos[i].Area);
					var fila3 = $('<td></td>').text(resultCursos[i].Desde.reverse().join("/"));
					var fila4 = $('<td></td>').text(resultCursos[i].Hasta.reverse().join("/"));
					var fila5 = $('<td></td>').text(resultCursos[i].Duracion);

					row2.append(fila1);
					row2.append(fila2);
					row2.append(fila3);
					row2.append(fila4);
					row2.append(fila5);									
				    table.append(row2);
				}
				$('#cursosproximos').append(table);
			}
			function calendario(){
                $('#calendario').datepicker({
				    language: "es",
				    format: "dd/mm/yyyy",			    

				    beforeShowDay: function (date){
				    	if(contador == 0){
				    		auxDesde = date.getTime();
				    		if(globaldesde != auxDesde){
					    		globaldesde = auxDesde;
					    		hasta = new Date(date);
				    			hasta = hasta.setMonth(hasta.getMonth()+2);
					    		buscarCursos(globaldesde/1000,hasta/1000);
					    	}
				    	}
				    	contador = (contador+1)%42;

						var evento;
						var infoEvento = "";
						var classes = "";
						var name = "";
						for(var i = eventos.length-1; i > -1; i--)
						{
							evento = new Date(eventos[i].Desde[0],eventos[i].Desde[1]-1,eventos[i].Desde[2]);
							if(evento.getTime() == date.getTime())
							{
								if(checkboxEnLinea1.checked 
									|| checkboxEnLinea2.checked && eventos[i].Area == "Perforacion"
									|| checkboxEnLinea3.checked && eventos[i].Area == "Yacimiento"
									|| checkboxEnLinea4.checked && eventos[i].Area == "Administracion"
									|| checkboxEnLinea5.checked && eventos[i].Area == "Finanzas"
									|| (checkboxEnLinea6.checked 
										&& eventos[i].Area != "Perforacion"
										&& eventos[i].Area != "Yacimiento"
										&& eventos[i].Area != "Administracion"
										&& eventos[i].Area != "Finanzas"
										)
									)
								{
									infoEvento +=
									"Curso: " + eventos[i].Curso +  
									"\n\tArea: "+  eventos[i].Area +
									"\n\tCupos: "+  eventos[i].Cupos +
									"\n\tDuración: "+  eventos[i].Duracion +
									'\n\tFecha finalización: '+ eventos[i].Hasta[2]+"/"+eventos[i].Hasta[1]+"/"+eventos[i].Hasta[0]+'\n\n';

									if(classes == ""){
										classes = eventos[i].Area;
										switch(classes){
											case "Yacimiento":
												break;
											case "Perforacion":
												break;
											case "Administracion":
												break;
											case "Finanzas":
												break;
											default:
												classes = "otros";
												break;
										}
									} else { classes = "multiple"; }
									name += eventos[i].Curso +  
											"|||" + eventos[i].Area +
											"|||" + eventos[i].Cupos +
											"|||" + eventos[i].Duracion +
											"|||" + eventos[i].Desde[2]+"/"+eventos[i].Desde[1]+"/"+eventos[i].Desde[0] +
											"|||" + eventos[i].Hasta[2]+"/"+eventos[i].Hasta[1]+"/"+eventos[i].Hasta[0] + "&&&";
								}
							}
						}
						if(infoEvento != ""){
							return {
								tooltip: infoEvento,
								classes: classes + "\" name=\"" + name.substring(0,name.length-3)
							};
		            	}
		            	return {
								tooltip: " ",
								classes: " "
		            	};
		            }
		        });  

				$('#calendario').on('click',  function(){
					console.log("calen click");
					AbrirModal();
				});
    		}
		});
    </script>

</body>
</html>

